services:
  # 1. Wiki.js 애플리케이션
  wiki:
    image: requarks/wiki:2.5
    container_name: wikijs
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # DB 설정은 이제 config.yml에서 가져오므로 여기서는 제거했습니다.
      # Node.js 메모리 제한 등 필요한 경우에만 추가합니다.
      NODE_ENV: production
    volumes:
      # [중요] 호스트의 설정 파일을 컨테이너가 읽는 경로(/wiki/config.yml)로 매핑
      - /APP/wikijs/config.yml:/wiki/config.yml
      # 데이터 영속성
      - /APP/wikijs/wiki-data:/wiki/data
    depends_on:
      - db

  # 2. PostgreSQL 데이터베이스
  db:
    image: postgres:17.7-alpine
    container_name: wikijs-db
    restart: unless-stopped
    ports:
      - "5432:5432"
    # [주의] DB 컨테이너 자체는 초기화를 위해 여전히 환경변수가 필요합니다!
    # 이 값들은 위 config.yml의 내용과 정확히 일치해야 합니다.
    environment:
      POSTGRES_DB: wiki
      POSTGRES_USER: wikijs
      POSTGRES_PASSWORD: wikijsrocks 
    volumes:
      - /APP/wikijs/db-data:/var/lib/postgresql/data
